При чтении числа сервер вычитает из него 1001, чтобы любое сгенерированное число становилось отрицательным.
При чтении сервером отрицательного числа, он завершается (клиент не изменил значение, то есть уже остановился).
При обнаружении клиентом положительного числа, клиент завершается (сервер не изменил значение, то есть уже остановился).