Помимо числа в разделяемой памяти сохраняется флаг, устанавливаемый клиентом при записи и очищаемый сервером при чтении.
Если при чтении флаг не установлен, то клиент ничего не записал (то есть остановился), и сервер также завершает работу.
Если при записи флаг установлен, то сервер не произвёл чтение (то есть остановился), и клиент также завершает работу.