Идея: улучшение способа 2. Помимо числа в разделяемой памяти сохраняется флаг, устанавливаемый клиентом при записи и очищаемый сервером при чтении.
Если при чтении флаг не установлен, то клиент ничего не записал (то есть остановился), и сервер завершает работу.